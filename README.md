# 設計

## クリーンアーキテクチャ

非機能要件 1.を満たすため、クリーンアーキテクチャの考えを取り入れる。

1.  第 1 層
    外部依存のレイヤー。自分の意図とは関係なく仕様変更やバージョンアップが行われる可能性がある外部アプリ、外部システム、フレームワークなどを含む。

    例：DB、外部 API、UI など。

    1. DB（postgres）
    2. 外部連携
        1. JquantsAPI
        2. IMAP（Gmail SBI 約定メール）
        3. スクレイピング（SBI 証券）
    3. UI（スプレッドシート）

2.  第 2 層
    外部依存レイヤーへの変換などを担うレイヤー。コントローラー。

    例：外部 API のレスポンスの整形、GAS からスプレッドシートへのデータ出力など。

    1. OPM（Prisma）
    2. 外部連携へのアクセス、または外部連携用の変換
        1. JquantsAPI
        2. IMAP（Gmail SBI 約定メール）
        3. スクレイピング（SBI 証券）
    3. GAS のうち UI 生成にかかわる箇所

3.  第 3 層
    外部に規定はされないかつビジネスロジックではないものがかかれるレイヤー。

    例：データベースのスキーマ、API のエンドポイント

    1. データベースのスキーマ
    2. 各種データの型指定
    3. EC2-GAS 通信

4.  第 4 層
    ビジネスロジックが書かれるレイヤー。社会的なルールなどシステム上の仕様変更があっても不変なコードのみ。

    例：PER, PBR, 自己資本比率, 配当の計算など。

## マイクロサービスアーキテクチャ

非機能要件 2,3 を満たすため、マイクロサービスアーキテクチャの考えを取り入れる。

特に 2. を意識し、各機能をモジュール単位で開発・置き換えできるようにする。3. は最終的な達成目標とし、並列化は各モジュールが出来上がってきてから考える。
